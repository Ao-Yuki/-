<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EIKEN Writing Trainer</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f4f7f6; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { color: #2c3e50; text-align: center; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background: #3498db; color: white; transition: 0.3s; }
        button:hover { background: #2980b9; }
        button.secondary { background: #95a5a6; }
        textarea { width: 100%; height: 150px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; margin-top: 10px; }
        .topic-area { background: #e8f4fd; padding: 15px; border-left: 5px solid #3498db; margin: 15px 0; }
        .upload-section { border: 2px dashed #3498db; padding: 20px; text-align: center; margin: 10px 0; border-radius: 8px; }
        .score-board { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .score-item { background: #fff; padding: 10px; border: 1px solid #eee; border-radius: 5px; text-align: center; }
        .correction-overlay { line-height: 2.5; background: #fff; padding: 20px; border-radius: 8px; border: 1px solid #ddd; }
        .error { color: #e74c3c; text-decoration: line-through; position: relative; }
        .fix { color: #27ae60; font-weight: bold; margin-left: 5px; }
    </style>
</head>
<body>

    <h1>EIKEN Writing Trainer</h1>

    <div class="card">
        <h3>1. 級を選んでください (Select Grade)</h3>
        <div class="btn-group">
            <button onclick="selectGrade('3')">3級 (Grade 3)</button>
            <button onclick="selectGrade('pre2')">準2級 (Pre-2)</button>
            <button onclick="selectGrade('2')">2級 (Grade 2)</button>
        </div>
    </div>

    <div id="type-selection" class="card" style="display:none;">
        <h3>2. 形式を選んでください (Select Type)</h3>
        <div id="type-buttons" class="btn-group"></div>
    </div>

    <div id="topic-section" class="card" style="display:none;">
        <h3>3. お題 (Topic)</h3>
        <div id="topic-text" class="topic-area"></div>
        
        <div class="upload-section">
            <p>【提出方法を選択】</p>
            <button onclick="showInput('text')">キーボードで入力</button>
            <button onclick="document.getElementById('file-upload').click()">写真をアップロード</button>
            <input type="file" id="file-upload" style="display:none" accept="image/*">
        </div>

        <div id="text-input-area" style="display:none;">
            <textarea id="student-writing" placeholder="Write your answer here..."></textarea>
            <button onclick="startCheck()" style="width:100%; margin-top:10px; background:#2ecc71;">添削する (Check Writing)</button>
        </div>
    </div>

    <div id="result-section" class="card" style="display:none;">
        <h3>4. 添削結果 (Feedback)</h3>
        <div class="correction-overlay" id="correction-display">
            </div>
        
        <div class="score-board">
            <div class="score-item">内容: <strong id="score-content">-</strong> / 4</div>
            <div class="score-item">構成: <strong id="score-structure">-</strong> / 4</div>
            <div class="score-item">語彙: <strong id="score-vocab">-</strong> / 4</div>
            <div class="score-item">文法: <strong id="score-grammar">-</strong> / 4</div>
        </div>
        <button class="secondary" onclick="location.reload()" style="margin-top:20px;">別のお題をやる</button>
    </div>

    <script>
        const questions = {
            '3': {
                'Opinion': 'Which do you like better, talking with your friends or sending messages to them?',
                'E-mail': 'From: Jack <br>Subject: Hi! <br>I like cooking. Do you often cook at home? What is your favorite food?'
            },
            'pre2': {
                'Opinion': 'Do you think it is a good idea for people to study in groups?',
                'E-mail': 'From: Amy <br>I heard you went to a new library. How was it? What kind of books do you usually read?'
            },
            '2': {
                'Opinion': 'Some people say that it is important for children to learn how to cook. What do you think about that?',
                'Summary': '(Summary Question) Read the text about Solar Energy and summarize it in 45-55 words.'
            }
        };

        function selectGrade(grade) {
            const typeSec = document.getElementById('type-selection');
            const typeBtns = document.getElementById('type-buttons');
            typeBtns.innerHTML = '';
            
            Object.keys(questions[grade]).forEach(type => {
                const btn = document.createElement('button');
                btn.innerText = type;
                btn.onclick = () => showTopic(grade, type);
                typeBtns.appendChild(btn);
            });
            
            typeSec.style.display = 'block';
            window.scrollTo(0, document.body.scrollHeight);
        }

        function showTopic(grade, type) {
            document.getElementById('topic-section').style.display = 'block';
            document.getElementById('topic-text').innerHTML = questions[grade][type];
            window.scrollTo(0, document.body.scrollHeight);
        }

        function showInput(type) {
            if(type === 'text') {
                document.getElementById('text-input-area').style.display = 'block';
            }
        }

        function startCheck() {
            // ここに将来的にGemini APIとの通信を入れます
            document.getElementById('result-section').style.display = 'block';
            const writing = document.getElementById('student-writing').value;
            
            // 簡易的な添削表示のデモ
            document.getElementById('correction-display').innerHTML = 
                writing.replace("good", "<span class='error'>good</span><span class='fix'>great</span>");
            
            // ダミースコア
            document.getElementById('score-content').innerText = "3";
            document.getElementById('score-structure').innerText = "4";
            document.getElementById('score-vocab').innerText = "2";
            document.getElementById('score-grammar').innerText = "3";
            
            window.scrollTo(0, document.body.scrollHeight);
        }
    </script>
</body>
</html>
